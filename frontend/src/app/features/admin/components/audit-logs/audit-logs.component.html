<div class="audit-logs-container">
  <h1>Audit Logs</h1>

  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        Filters
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="filterForm" class="filter-form">
        <mat-form-field appearance="outline">
          <mat-label>Event Type</mat-label>
          <mat-select formControlName="eventType">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let type of eventTypes" [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Action</mat-label>
          <mat-select formControlName="action">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let action of actions" [value]="action">
              {{ action }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Correlation ID</mat-label>
          <input matInput formControlName="correlationId" placeholder="Enter correlation ID">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="startPicker" formControlName="startDate">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="endPicker" formControlName="endDate">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <div class="filter-actions">
          <button mat-raised-button color="primary" (click)="applyFilters()" [disabled]="loading">
            <mat-icon>search</mat-icon>
            Apply Filters
          </button>
          <button mat-stroked-button (click)="clearFilters()" [disabled]="loading">
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="logs-card">
    <mat-card-content>
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading audit logs...</p>
      </div>

      <div *ngIf="error" class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
      </div>

      <div *ngIf="!loading && !error">
        <div *ngIf="auditLogs.length === 0" class="empty-state">
          <mat-icon>inbox</mat-icon>
          <h3>No audit logs found</h3>
          <p>Try adjusting your filters</p>
        </div>

        <div *ngIf="auditLogs.length > 0" class="table-container">
          <table mat-table [dataSource]="auditLogs" class="audit-table">
            <ng-container matColumnDef="createdAt">
              <th mat-header-cell *matHeaderCellDef>Date/Time</th>
              <td mat-cell *matCellDef="let log">{{ formatDate(log.createdAt) }}</td>
            </ng-container>

            <ng-container matColumnDef="eventType">
              <th mat-header-cell *matHeaderCellDef>Event Type</th>
              <td mat-cell *matCellDef="let log">{{ log.eventType }}</td>
            </ng-container>

            <ng-container matColumnDef="userName">
              <th mat-header-cell *matHeaderCellDef>User</th>
              <td mat-cell *matCellDef="let log">
                <div class="user-info">
                  <span class="user-name">{{ log.userName }}</span>
                  <span class="user-email" *ngIf="log.userEmail">{{ log.userEmail }}</span>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="resourceType">
              <th mat-header-cell *matHeaderCellDef>Resource</th>
              <td mat-cell *matCellDef="let log">
                {{ log.resourceType }}
                <span *ngIf="log.resourceId" class="resource-id">#{{ log.resourceId }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Action</th>
              <td mat-cell *matCellDef="let log">
                <span class="action-badge" [class]="'action-' + log.action.toLowerCase()">
                  {{ log.action }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="ipAddress">
              <th mat-header-cell *matHeaderCellDef>IP Address</th>
              <td mat-cell *matCellDef="let log">{{ log.ipAddress }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-paginator
            [length]="totalElements"
            [pageSize]="pageSize"
            [pageIndex]="pageIndex"
            [pageSizeOptions]="[20, 50, 100]"
            (page)="onPageChange($event)">
          </mat-paginator>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
